language: python

sudo: required
dist: trusty
group: deprecated-2017Q2

env:
  - TEST="flake8"
  - TEST=basic OS=debian8 PYTHON=3
  - TEST=extrasettings OS=debian8 PYTHON=3
  - TEST=extraserver OS=debian8 PYTHON=3
  - TEST=basicserver OS=debian8 PYTHON=3
  - TEST=basicsettings OS=debian8 PYTHON=3
  - TEST=basic OS=debian9 PYTHON=3
  - TEST=extrasettings OS=debian9 PYTHON=3
  - TEST=extraserver OS=debian9 PYTHON=3
  - TEST=basicserver OS=debian9 PYTHON=3
  - TEST=basicsettings OS=debian9 PYTHON=3
  - TEST=basic OS=debian9 PYTHON=2
  - TEST=extrasettings OS=debian9 PYTHON=2
  - TEST=extraserver OS=debian9 PYTHON=2
  - TEST=basicserver OS=debian9 PYTHON=2
  - TEST=basicsettings OS=debian9 PYTHON=2
  - TEST=basic OS=debian8 PYTHON=2
  - TEST=extrasettings OS=debian8 PYTHON=2
  - TEST=extraserver OS=debian8 PYTHON=2
  - TEST=basicserver OS=debian8 PYTHON=2
  - TEST=basicsettings OS=debian8 PYTHON=2
  # - TEST=basic OS=ubuntu16.04 PYTHON=2
  # - TEST=extrasettings OS=ubuntu16.04 PYTHON=2
  # - TEST=extraserver OS=ubuntu16.04 PYTHON=2
  # - TEST=basicserver OS=ubuntu16.04 PYTHON=2
  # - TEST=basicsettings OS=ubuntu16.04 PYTHON=2
  # - TEST=basic OS=ubuntu18.04 PYTHON=2
  # - TEST=extrasettings OS=ubuntu18.04 PYTHON=2
  # - TEST=extraserver OS=ubuntu18.04 PYTHON=2
  # - TEST=basicserver OS=ubuntu18.04 PYTHON=2
  # - TEST=basicsettings OS=ubuntu18.04 PYTHON=2
  # - TEST=basic OS=ubuntu16.04 PYTHON=3
  # - TEST=extrasettings OS=ubuntu16.04 PYTHON=3
  # - TEST=extraserver OS=ubuntu16.04 PYTHON=3
  # - TEST=basicserver OS=ubuntu16.04 PYTHON=3
  # - TEST=basicsettings OS=ubuntu16.04 PYTHON=3
  # - TEST=basic OS=ubuntu18.04 PYTHON=3
  # - TEST=extrasettings OS=ubuntu18.04 PYTHON=3
  # - TEST=extraserver OS=ubuntu18.04 PYTHON=3
  # - TEST=basicserver OS=ubuntu18.04 PYTHON=3
  # - TEST=basicsettings OS=ubuntu18.04 PYTHON=3


services:
  - docker


before_install:
  - if [ $TEST == "flake8" ]; then sudo apt-get update -qq ; fi
  - if [ $TEST == "flake8" ]; then sudo pip install flake8; fi
  - if [ $TEST != "flake8" ]; then chmod +x .travis/run.sh; fi
  - if [ $TEST != "flake8" ]; then chmod +x .travis/install.sh; fi

before_script:
  - if [ $TEST != "flake8" ]; then docker build -t ndts .travis/${OS}_py${PYTHON}; fi
  - if [ $TEST != "flake8" ]; then docker run  --name  ndts -d -it -v `pwd`:/home/tango  ndts; fi
  - if [ $TEST != "flake8" ]; then .travis/install.sh ${OS} ${PYTHON}; fi

script:
  - if [ $TEST != "flake8" ]; then .travis/run.sh ${TEST} ${PYTHON}; fi
  - if [ $TEST == "flake8" ]; then flake8; fi

after-script:
  - if [ $TEST != "flake8" ]; then docker stop ndts; fi
  - if [ $TEST != "flake8" ]; then docker rm ndts; fi
